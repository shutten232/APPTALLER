<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Carga Taller GNC · Quirgroup</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root{
      --amarillo:#ffd600;
      --rojo:#e3000b;
      --azul:#003a70;

      --fondo:#f1f3f6;
      --card:#ffffff;
      --borde:#d4d7dd;
      --texto:#111111;
      --texto-suave:#6b7280;
    }

    *{
      box-sizing:border-box;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    }

    body{
      margin:0;
      padding:10px;
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      background:var(--fondo);
      color:var(--texto);
      font-size:16px;
    }

    /* INTRO SOLO LOGO */
    .splash-overlay{
      position:fixed;
      inset:0;
      background:radial-gradient(circle at 10% 0%, #0b1935 0, #020617 45%, #000000 100%);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:999;
      transition:opacity .6s ease, transform .6s ease, visibility .6s ease;
    }

    .splash-overlay.splash-hidden{
      opacity:0;
      visibility:hidden;
      transform:scale(1.03);
      pointer-events:none;
    }

    .splash-logo{
      animation:logoFloat 1.8s ease-in-out infinite alternate;
    }

    .marca-splash{
      display:inline-flex;
      align-items:center;
      padding:5px 16px 6px;
      border-radius:999px;
      background:var(--amarillo);
      box-shadow:0 0 0 2px rgba(0,0,0,.4), 0 10px 24px rgba(0,0,0,.9);
      transform:scale(1.15);
    }

    .marca-splash span.quir{
      font-weight:900;
      text-transform:uppercase;
      letter-spacing:.1em;
      font-size:14px;
      color:var(--rojo);
      margin-right:4px;
    }

    .marca-splash span.group{
      font-weight:700;
      text-transform:uppercase;
      letter-spacing:.08em;
      font-size:13px;
      color:#111111;
    }

    .marca-splash span.gnc-pill{
      margin-left:6px;
      padding:2px 8px 3px;
      border-radius:999px;
      background:var(--azul);
      color:var(--amarillo);
      font-weight:700;
      font-size:11px;
      letter-spacing:.16em;
    }

    @keyframes logoFloat{
      from{ transform:translateY(0) scale(1.15); }
      to{ transform:translateY(-4px) scale(1.2); }
    }

    /* APP PRINCIPAL */

    .app{
      width:100%;
      max-width:480px;
      background:var(--card);
      border-radius:20px;
      box-shadow:0 10px 30px rgba(0,0,0,.12);
      padding:14px 14px 18px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:4px 0 10px;
      border-bottom:1px solid var(--borde);
      margin-bottom:6px;
    }

    .marca{
      display:inline-flex;
      align-items:center;
      padding:3px 12px 4px;
      border-radius:999px;
      background:var(--amarillo);
      box-shadow:0 0 0 1px rgba(0,0,0,.15);
    }

    .marca span.quir{
      font-weight:900;
      text-transform:uppercase;
      letter-spacing:.06em;
      font-size:12px;
      color:var(--rojo);
      margin-right:3px;
    }

    .marca span.group{
      font-weight:700;
      text-transform:uppercase;
      letter-spacing:.05em;
      font-size:11px;
      color:#111111;
    }

    .marca span.gnc-pill{
      margin-left:6px;
      padding:1px 6px 2px;
      border-radius:999px;
      background:var(--azul);
      color:var(--amarillo);
      font-weight:700;
      font-size:10px;
      letter-spacing:.12em;
    }

    .topbar-titulos{
      text-align:right;
      margin-left:12px;
      flex:1;
    }

    .topbar-titulos h1{
      font-size:16px;
      margin:0;
      font-weight:700;
      letter-spacing:.12em;
      text-transform:uppercase;
      color:var(--azul);
    }

    .subfecha{
      font-size:12px;
      color:var(--texto-suave);
      margin:2px 0 0;
    }

    .tabs{
      margin:12px 0;
      display:flex;
      background:#e5e7eb;
      border-radius:999px;
      padding:4px;
    }

    .tab{
      flex:1;
      border:none;
      border-radius:999px;
      padding:8px 0;
      font-size:14px;
      font-weight:600;
      cursor:pointer;
      background:transparent;
      color:var(--texto-suave);
      transition:.15s;
    }

    .tab.activa{
      background:var(--azul);
      color:#ffffff;
      box-shadow:0 2px 6px rgba(0,0,0,.25);
    }

    .panel{
      border-radius:16px;
      border:1px solid var(--borde);
      padding:12px 12px 14px;
      margin-bottom:12px;
      background:#f9fafb;
    }

    .panel-titulo{
      font-size:14px;
      font-weight:600;
      margin-bottom:6px;
      text-transform:uppercase;
      letter-spacing:.06em;
      color:var(--azul);
    }

    .resumen-linea{
      font-size:13px;
      margin:0;
      color:var(--texto-suave);
    }

    .resumen-linea span{
      font-weight:600;
      color:var(--texto);
    }

    .ultima-actualizacion{
      margin-top:4px;
      font-size:11px;
      color:var(--texto-suave);
    }

    .grupo-campos{
      margin-top:10px;
    }

    .campo{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:8px;
      gap:6px;
    }

    .campo-label{
      font-size:14px;
      flex:1.1;
    }

    .campo-controles{
      display:flex;
      align-items:center;
      gap:4px;
      flex:1;
      justify-content:flex-end;
    }

    .campo-controles button{
      width:36px;
      height:36px;
      border-radius:10px;
      border:1px solid var(--borde);
      background:#ffffff;
      font-size:18px;
      line-height:1;
      cursor:pointer;
      color:var(--azul);
      box-shadow:0 1px 3px rgba(0,0,0,.12);
    }

    .campo-controles button:active{
      transform:translateY(1px);
      box-shadow:0 1px 1px rgba(0,0,0,.2);
    }

    .campo-controles input{
      width:70px;
      text-align:center;
      padding:5px 6px;
      border-radius:10px;
      border:1px solid var(--borde);
      font-size:14px;
      background:#ffffff;
      color:var(--texto);
    }

    .campo-texto{
      display:flex;
      flex-direction:column;
      margin-top:10px;
    }

    .campo-texto .campo-label{
      font-size:13px;
      color:var(--texto-suave);
    }

    .campo-texto textarea{
      margin-top:6px;
      width:100%;
      border-radius:12px;
      border:1px solid var(--borde);
      padding:8px 10px;
      font-size:14px;
      resize:vertical;
      min-height:140px;
      background:#ffffff;
      color:var(--texto);
    }

    .campo-texto textarea::placeholder{
      color:#9ca3af;
    }

    .btn-guardar{
      width:100%;
      margin-top:12px;
      padding:10px 0;
      border:none;
      border-radius:999px;
      background:linear-gradient(90deg,var(--amarillo),#ffb400);
      color:#111111;
      font-weight:700;
      font-size:14px;
      cursor:pointer;
      box-shadow:0 4px 12px rgba(0,0,0,.25);
      text-transform:uppercase;
      letter-spacing:.08em;
    }

    .btn-guardar:active{
      transform:translateY(1px);
      box-shadow:0 2px 6px rgba(0,0,0,.3);
    }

    .comparacion{
      margin-top:8px;
      border-radius:16px;
      border:1px solid var(--borde);
      padding:10px 12px;
      background:#ffffff;
    }

    .comparacion-titulo{
      font-size:13px;
      font-weight:600;
      margin-bottom:6px;
      text-transform:uppercase;
      letter-spacing:.06em;
      color:var(--azul);
    }

    .comparacion-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:8px;
      font-size:12px;
    }

    .comparacion-col{
      background:#f3f4f6;
      border-radius:12px;
      padding:6px 8px;
      border:1px solid #e5e7eb;
    }

    .comparacion-col h3{
      margin:0 0 2px;
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:.05em;
      color:var(--azul);
    }

    .comparacion-col p{
      margin:0;
      color:var(--texto-suave);
    }

    .alerta{
      margin-top:8px;
      font-size:12px;
      padding:7px 8px;
      border-radius:12px;
      background:#fff7d6;
      border:1px solid #facc15;
      color:#854d0e;
    }

    .alerta strong{
      color:#92400e;
    }
  </style>

  <!-- SDK Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
</head>
<body>
  <!-- INTRO SOLO LOGO -->
  <div class="splash-overlay" id="splash">
    <div class="splash-logo">
      <div class="marca-splash">
        <span class="quir">QUIR</span>
        <span class="group">GROUP</span>
        <span class="gnc-pill">GNC</span>
      </div>
    </div>
  </div>

  <!-- APP -->
  <div class="app">
    <div class="topbar">
      <div class="marca">
        <span class="quir">QUIR</span>
        <span class="group">GROUP</span>
        <span class="gnc-pill">GNC</span>
      </div>
      <div class="topbar-titulos">
        <h1>Carga Taller</h1>
        <div class="subfecha" id="subfecha"></div>
      </div>
    </div>

    <div class="tabs">
      <button class="tab activa" data-taller="zipoli">Zipoli</button>
      <button class="tab" data-taller="alem">Alem</button>
    </div>

    <div class="panel" id="panel-taller">
      <div class="panel-titulo" id="titulo-taller">Taller Zipoli – Hoy</div>
      <p class="resumen-linea">
        Personal: <span id="res-personal">0</span> ·
        Turnos totales: <span id="res-turnos">0</span>
      </p>
      <div class="ultima-actualizacion" id="ultima-actualizacion">
        Sin registrar todavía
      </div>

      <div class="grupo-campos">
        <div class="campo">
          <div class="campo-label">Personal presente</div>
          <div class="campo-controles">
            <button data-op="-" data-campo="personal">−</button>
            <input type="number" id="inp-personal" min="0" step="1">
            <button data-op="+" data-campo="personal">+</button>
          </div>
        </div>

        <div class="campo">
          <div class="campo-label">Services GNC</div>
          <div class="campo-controles">
            <button data-op="-" data-campo="services">−</button>
            <input type="number" id="inp-services" min="0" step="1">
            <button data-op="+" data-campo="services">+</button>
          </div>
        </div>

        <div class="campo">
          <div class="campo-label">Pruebas hidráulicas</div>
          <div class="campo-controles">
            <button data-op="-" data-campo="pruebas">−</button>
            <input type="number" id="inp-pruebas" min="0" step="1">
            <button data-op="+" data-campo="pruebas">+</button>
          </div>
        </div>

        <div class="campo">
          <div class="campo-label">Instalaciones</div>
          <div class="campo-controles">
            <button data-op="-" data-campo="instalaciones">−</button>
            <input type="number" id="inp-instalaciones" min="0" step="1">
            <button data-op="+" data-campo="instalaciones">+</button>
          </div>
        </div>

        <div class="campo">
          <div class="campo-label">Otros trabajos</div>
          <div class="campo-controles">
            <button data-op="-" data-campo="otros">−</button>
            <input type="number" id="inp-otros" min="0" step="1">
            <button data-op="+" data-campo="otros">+</button>
          </div>
        </div>

        <div class="campo-texto">
          <div class="campo-label">Observaciones (pruebas, instalaciones, etc.)</div>
          <textarea id="inp-observaciones" placeholder="Ej: 2 pruebas demoradas, 1 instalación grande, falta personal turno tarde..."></textarea>
        </div>
      </div>

      <button class="btn-guardar" id="btn-guardar">Guardar</button>
    </div>

    <div class="comparacion">
      <div class="comparacion-titulo">Resumen rápido Zipoli vs Alem</div>
      <div class="comparacion-grid">
        <div class="comparacion-col">
          <h3>Zipoli</h3>
          <p id="cmp-zipoli">Sin datos</p>
        </div>
        <div class="comparacion-col">
          <h3>Alem</h3>
          <p id="cmp-alem">Sin datos</p>
        </div>
      </div>
      <div class="alerta" id="alerta">
        Carga similar en ambos talleres. Revisar entre encargados si hace falta mover gente.
      </div>
    </div>
  </div>

  <script>
    // INTRO: auto-ocultar y tap para saltar
    const splash = document.getElementById('splash');
    function ocultarSplash(){
      if(!splash.classList.contains('splash-hidden')){
        splash.classList.add('splash-hidden');
      }
    }
    setTimeout(ocultarSplash, 1800);
    splash.addEventListener('click', ocultarSplash);

    // Fecha del día
    const hoy = new Date();
    const fechaClave = hoy.toISOString().slice(0,10); // yyyy-mm-dd

    const subfecha = document.getElementById('subfecha');
    subfecha.textContent = hoy.toLocaleDateString('es-AR',{
      weekday:'long',
      day:'numeric',
      month:'short'
    });

    // --- Firebase INIT (Realtime Database gratis) ---
    const firebaseConfig = {
      apiKey: "AIzaSyB34UYCqVAnvN55YrapcVsoSbJOT-GyKIE",
      authDomain: "appquiroga.firebaseapp.com",
      projectId: "appquiroga",
      storageBucket: "appquiroga.firebasestorage.app",
      messagingSenderId: "940643500518",
      appId: "1:940643500518:web:d7df08c47223256fc4d627",
      measurementId: "G-6QF5YXY7X3",
      // IMPORTANTE: asegurate que coincida con tu URL de Realtime Database
      databaseURL: "https://appquiroga-default-rtdb.firebaseio.com"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const ROOT_PATH = "cargaTaller";
    const diaRef = db.ref(ROOT_PATH + "/" + fechaClave);

    // --- Estado en memoria ---
    function baseTaller() {
      return {
        personal:0,
        services:0,
        pruebas:0,
        instalaciones:0,
        otros:0,
        obs:'',
        updated:null
      };
    }

    let datos = {
      fecha: fechaClave,
      zipoli: baseTaller(),
      alem:   baseTaller()
    };

    const tabs = document.querySelectorAll('.tab');
    let tallerActual = 'zipoli';

    const inputs = {
      personal: document.getElementById('inp-personal'),
      services: document.getElementById('inp-services'),
      pruebas: document.getElementById('inp-pruebas'),
      instalaciones: document.getElementById('inp-instalaciones'),
      otros: document.getElementById('inp-otros')
    };
    const inpObs = document.getElementById('inp-observaciones');

    const resPersonal = document.getElementById('res-personal');
    const resTurnos = document.getElementById('res-turnos');
    const tituloTaller = document.getElementById('titulo-taller');
    const ultimaAct = document.getElementById('ultima-actualizacion');

    const cmpZipoli = document.getElementById('cmp-zipoli');
    const cmpAlem = document.getElementById('cmp-alem');
    const alerta = document.getElementById('alerta');

    // --- UI helpers ---
    function llenarFormulario() {
      const d = datos[tallerActual] || baseTaller();

      inputs.personal.value       = d.personal;
      inputs.services.value       = d.services;
      inputs.pruebas.value        = d.pruebas;
      inputs.instalaciones.value  = d.instalaciones;
      inputs.otros.value          = d.otros;
      inpObs.value                = d.obs || '';

      const totalTurnos = d.services + d.pruebas + d.instalaciones + d.otros;
      resPersonal.textContent = d.personal;
      resTurnos.textContent   = totalTurnos;

      tituloTaller.textContent = 'Taller ' + (tallerActual === 'zipoli' ? 'Zipoli' : 'Alem') + ' – Hoy';

      if(d.updated){
        ultimaAct.textContent = 'Última actualización: ' + d.updated;
      }else{
        ultimaAct.textContent = 'Sin registrar todavía';
      }
    }

    function actualizarComparacion() {
      function texto(d){
        const t = d.services + d.pruebas + d.instalaciones + d.otros;
        if(d.personal===0 && t===0) return 'Sin datos';
        return (
          'Personal: ' + d.personal +
          ' · Turnos: ' + t +
          ' (S:' + d.services +
          ' / P:' + d.pruebas +
          ' / I:' + d.instalaciones +
          ' / O:' + d.otros + ')'
        );
      }

      const dz = datos.zipoli || baseTaller();
      const da = datos.alem   || baseTaller();

      cmpZipoli.textContent = texto(dz);
      cmpAlem.textContent   = texto(da);

      const tz = dz.services + dz.pruebas + dz.instalaciones + dz.otros;
      const ta = da.services + da.pruebas + da.instalaciones + da.otros;

      if(tz === 0 && ta === 0){
        alerta.textContent = 'Todavía no hay carga cargada para hoy en ninguno de los dos talleres.';
      }else if(tz > ta){
        alerta.innerHTML = '<strong>Más cargado: Zipoli.</strong> Evaluar si conviene mandar alguien desde Alem.';
      }else if(ta > tz){
        alerta.innerHTML = '<strong>Más cargado: Alem.</strong> Evaluar si conviene mandar alguien desde Zipoli.';
      }else{
        alerta.textContent = 'Carga similar en ambos talleres. Revisar entre encargados si hace falta mover gente.';
      }
    }

    // --- Listeners Realtime Database ---
    function initRealtime() {
      ['zipoli','alem'].forEach(taller => {
        diaRef.child(taller).on('value', snap => {
          const val = snap.val();
          if(val){
            datos[taller] = Object.assign(baseTaller(), val);
          }else{
            datos[taller] = baseTaller();
          }
          if(taller === tallerActual){
            llenarFormulario();
          }
          actualizarComparacion();
        });
      });
    }

    initRealtime();

    // --- Tabs ---
    tabs.forEach(tab=>{
      tab.addEventListener('click',()=>{
        tabs.forEach(t=>t.classList.remove('activa'));
        tab.classList.add('activa');
        tallerActual = tab.dataset.taller;
        llenarFormulario();
      });
    });

    // --- Botones +/- ---
    document.getElementById('panel-taller')
      .addEventListener('click',(e)=>{
        const btn = e.target;
        if(btn.tagName !== 'BUTTON') return;
        const op = btn.dataset.op;
        const campo = btn.dataset.campo;
        if(!op || !campo) return;
        const input = inputs[campo];
        let val = parseInt(input.value || '0',10);
        if(op === '+') val++;
        if(op === '-' && val>0) val--;
        input.value = val;
      });

    // --- Guardar en Realtime Database ---
    document.getElementById('btn-guardar')
      .addEventListener('click',()=>{
        const d = datos[tallerActual];

        d.personal      = parseInt(inputs.personal.value      || '0',10);
        d.services      = parseInt(inputs.services.value      || '0',10);
        d.pruebas       = parseInt(inputs.pruebas.value       || '0',10);
        d.instalaciones = parseInt(inputs.instalaciones.value || '0',10);
        d.otros         = parseInt(inputs.otros.value         || '0',10);
        d.obs           = inpObs.value.trim();
        d.updated       = new Date().toLocaleTimeString('es-AR',{hour:'2-digit',minute:'2-digit'});

        const payload = {
          personal: d.personal,
          services: d.services,
          pruebas: d.pruebas,
          instalaciones: d.instalaciones,
          otros: d.otros,
          obs: d.obs,
          updated: d.updated
        };

        diaRef.child(tallerActual).set(payload)
          .catch(err=>{
            console.error(err);
            alert('Error al guardar en la base de datos: ' + err.message);
          });
      });

    // Primera carga de la UI con valores por defecto
    llenarFormulario();
    actualizarComparacion();
  </script>
</body>
</html>
